<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Giulio Morina" />

<meta name="date" content="2019-01-15" />

<title>Reproducing Paper Examples</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Reproducing Paper Examples</h1>
<h4 class="author"><em>Giulio Morina</em></h4>
<h4 class="date"><em>2019-01-15</em></h4>


<div id="TOC">
<ul>
<li><a href="#example-1---toy-bernoulli-factory">Example 1 - Toy Bernoulli Factory</a></li>
<li><a href="#example-2---efficiency-of-monotonic-cftp">Example 2 - Efficiency of Monotonic CFTP</a></li>
<li><a href="#example-3---dice-enterprise">Example 3 - Dice Enterprise</a></li>
<li><a href="#example-4---augmenting-ladder-bernoulli-factory">Example 4 - Augmenting ladder (Bernoulli factory)</a></li>
<li><a href="#example-5---augmenting-ladder-dice-enterprise">Example 5 - Augmenting ladder (Dice enterprise)</a></li>
</ul>
</div>

<div id="example-1---toy-bernoulli-factory" class="section level2">
<h2>Example 1 - Toy Bernoulli Factory</h2>
<p><span class="math display">\[
f(p) = \frac{\sqrt{2}p^3}{(\sqrt{2}-5)p^3+11p^2-9p+3}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_size &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#Number of tosses</span>
probs_vec &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>,<span class="fl">0.99</span>) <span class="co">#Vector of true probabilities of the p-coin</span>
num_cores &lt;-<span class="st"> </span><span class="dv">2</span> <span class="co">#Number of cores used (parallel computing is not supported on Windows)</span>
conf_level &lt;-<span class="st"> </span><span class="fl">0.95</span> <span class="co">#Confidence interval level</span></code></pre></div>
<table>
<colgroup>
<col width="34%"></col>
<col width="8%"></col>
<col width="8%"></col>
<col width="8%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="8%"></col>
<col width="8%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">0.01</th>
<th align="center">0.1</th>
<th align="center">0.25</th>
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
<th align="center">0.99</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>f(p)</strong></td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0.02</td>
<td align="center">0.22</td>
<td align="center">0.65</td>
<td align="center">0.86</td>
<td align="center">0.99</td>
</tr>
<tr class="even">
<td align="center"><strong>LowerCI</strong></td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0.01</td>
<td align="center">0.18</td>
<td align="center">0.63</td>
<td align="center">0.86</td>
<td align="center">0.98</td>
</tr>
<tr class="odd">
<td align="center"><strong>Emp.f(p)</strong></td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0.01</td>
<td align="center">0.21</td>
<td align="center">0.66</td>
<td align="center">0.88</td>
<td align="center">0.99</td>
</tr>
<tr class="even">
<td align="center"><strong>UppCI</strong></td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0.02</td>
<td align="center">0.23</td>
<td align="center">0.69</td>
<td align="center">0.9</td>
<td align="center">0.99</td>
</tr>
<tr class="odd">
<td align="center"><strong>Exp.TossesNoDoubling</strong></td>
<td align="center">4.8</td>
<td align="center">5.61</td>
<td align="center">7.45</td>
<td align="center">10.61</td>
<td align="center">8.05</td>
<td align="center">6.51</td>
<td align="center">5.94</td>
</tr>
<tr class="even">
<td align="center"><strong>Exp.TossesDoubling</strong></td>
<td align="center">5.98</td>
<td align="center">7.12</td>
<td align="center">9.58</td>
<td align="center">13.78</td>
<td align="center">10.74</td>
<td align="center">8.65</td>
<td align="center">7.74</td>
</tr>
</tbody>
</table>
</div>
<div id="example-2---efficiency-of-monotonic-cftp" class="section level2">
<h2>Example 2 - Efficiency of Monotonic CFTP</h2>
<p>We consider the ladder <span class="math display">\[
\pi(p) \propto ((1-p)^4,1000p(1-p)^3,p^2(1-p)^2,500p^3(1-p),p^4)
\]</span> and show that increasing the degree of the ladder leads to better performance in terms of the expected number of tosses of the <span class="math inline">\(p\)</span>-coin.</p>
<pre><code>  0.01     0.1    0.25      0.5     0.75      0.9     0.99</code></pre>
<p>+0 561.309 621.732 827.855 1332.628 1433.588 1209.278 1090.539 +1 92.351 12.206 7.721 8.649 9.476 12.589 87.051 +2 93.165 13.329 9.425 11.294 11.665 14.469 89.564 Eff.Condition +0 0 +1 0 +2 1</p>
<table style="width:100%;">
<colgroup>
<col width="11%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="10%"></col>
<col width="18%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">0.01</th>
<th align="center">0.1</th>
<th align="center">0.25</th>
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">Eff.Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>+0</strong></td>
<td align="center">561.3</td>
<td align="center">621.7</td>
<td align="center">827.9</td>
<td align="center">1333</td>
<td align="center">1434</td>
<td align="center">1209</td>
<td align="center">1091</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><strong>+1</strong></td>
<td align="center">92.35</td>
<td align="center">12.21</td>
<td align="center">7.721</td>
<td align="center">8.649</td>
<td align="center">9.476</td>
<td align="center">12.59</td>
<td align="center">87.05</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center"><strong>+2</strong></td>
<td align="center">93.17</td>
<td align="center">13.33</td>
<td align="center">9.425</td>
<td align="center">11.29</td>
<td align="center">11.66</td>
<td align="center">14.47</td>
<td align="center">89.56</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
</div>
<div id="example-3---dice-enterprise" class="section level2">
<h2>Example 3 - Dice Enterprise</h2>
<p><span class="math display">\[
\pi(p_1,p_2,p_3) \propto \left(\sqrt{2}p_1^3,p_1^2p_3,\frac{1}{4}p_1p_2^2,2p_1p_2p_3,\frac{1}{2}p_1p_3^2,\frac{3}{4}p_2^2p_3\right)
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_size &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#Number of rolls</span>
probs_mat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>,<span class="dv">11</span><span class="op">/</span><span class="dv">20</span>,
                      <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>,<span class="dv">4</span><span class="op">/</span><span class="dv">10</span>,<span class="dv">5</span><span class="op">/</span><span class="dv">10</span>), <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>) <span class="co">#Matrix of true probabilities of the die</span>
num_cores &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#Number of cores used (parallel computing is not supported on Windows)</span>
conf_level &lt;-<span class="st"> </span><span class="fl">0.95</span> <span class="co">#Confidence interval level</span></code></pre></div>
<pre><code>#&gt; 
#&gt; -------------------------------------------------------------------------------------------
#&gt;          &amp;nbsp;                  (0.2, 0.25, 0.55)                 (0.1, 0.4, 0.5)         
#&gt; ------------------------- -------------------------------- --------------------------------
#&gt;         **f(p)**           (0.08, 0.15, 0.02, 0.37, 0.21,   (0.01, 0.04, 0.03, 0.33, 0.1,  
#&gt;                                        0.17)                            0.49)              
#&gt; 
#&gt;        **LowerCI**          (0.04, 0.13, 0, 0.32, 0.18,     (0, 0.01, 0, 0.29, 0.06, 0.47) 
#&gt;                                        0.15)                                               
#&gt; 
#&gt;       **Emp.f(p)**         (0.07, 0.16, 0.02, 0.36, 0.22,   (0.01, 0.04, 0.04, 0.32, 0.09, 
#&gt;                                        0.18)                             0.5)              
#&gt; 
#&gt;         **UppCI**           (0.1, 0.2, 0.05, 0.39, 0.25,    (0.04, 0.07, 0.07, 0.36, 0.12, 
#&gt;                                        0.21)                            0.54)              
#&gt; 
#&gt;  **Exp.RollsNoDoubling**                9.6                             10.42              
#&gt; 
#&gt;   **Exp.RollsDoubling**                12.84                            14.03              
#&gt; -------------------------------------------------------------------------------------------</code></pre>
</div>
<div id="example-4---augmenting-ladder-bernoulli-factory" class="section level2">
<h2>Example 4 - Augmenting ladder (Bernoulli factory)</h2>
<p>We consider a ladder of the following form, where the true (unknown) <span class="math inline">\(p\)</span> is <span class="math inline">\(1/2\)</span>: <span class="math display">\[
\pi(p) \propto \{p^{2a},p^a(1-p)^a,(1-p)^{2a}\}
\]</span> A naive approach similar to the 2-coin algorithm would be with probability <span class="math inline">\(1/3\)</span>, toss a <span class="math inline">\(p\)</span>-coin <span class="math inline">\(2a\)</span> times and output <span class="math inline">\(1\)</span> if all heads; with prob. <span class="math inline">\(1/3\)</span> toss a <span class="math inline">\(p\)</span>-coin <span class="math inline">\(2a\)</span> times and output <span class="math inline">\(1\)</span> if the first <span class="math inline">\(a\)</span> are heads and the last <span class="math inline">\(a\)</span> tosses are tails; with prob. <span class="math inline">\(1/3\)</span> toss a <span class="math inline">\(p\)</span>-coin <span class="math inline">\(2a\)</span> times and output <span class="math inline">\(1\)</span> if all tails. This would require on average <span class="math inline">\(\mathbb{E}_{p=1/2}[N] = 2^{2a}\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())
<span class="kw">require</span>(<span class="st">&quot;DiceEnterprise&quot;</span>)

p &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span> <span class="co">#True value of p</span>
a &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co">#Exponent</span>
n &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#Size sample CFTP</span>
num_cores &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#Number of cores used</span>
initial_seed &lt;-<span class="st"> </span><span class="dv">17</span> <span class="co">#Seed for RNG</span>
increase_degree &lt;-<span class="st"> </span><span class="dv">260</span> <span class="co">#How much the degree is increased</span>
de_list &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> increase_degree<span class="op">+</span><span class="dv">1</span>) <span class="co">#Store all the de objects</span>

<span class="kw">set.seed</span>(initial_seed, <span class="st">&quot;L'Ecuyer-CMRG&quot;</span>) 
<span class="co">#Construct the ladder</span>
<span class="kw">cat</span>(<span class="st">&quot;Constructing the dice enterprise </span><span class="ch">\n</span><span class="st">&quot;</span>)
  de &lt;-<span class="st"> </span>DiceEnterprise<span class="op">$</span><span class="kw">new</span>(<span class="dt">G=</span><span class="kw">list</span>(
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span><span class="op">*</span>a,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">2</span>)),
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(a,a),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">2</span>)),
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span><span class="op">*</span>a),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">2</span>))
  ))
  de_list[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>de
  <span class="kw">cat</span>(<span class="st">&quot;Constructing the augmented dice enterprises </span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>increase_degree) {
    <span class="co">#Check if it already exists</span>
    <span class="cf">if</span>(<span class="kw">file.exists</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_uni_data/ladder_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))) {
      <span class="kw">cat</span>(<span class="st">&quot;Restoring previous work for degree +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
      prev_work &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_uni_data/ladder_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
      de_list[[i<span class="op">+</span><span class="dv">1</span>]]  &lt;-<span class="st"> </span>prev_work<span class="op">$</span>de_aug
    } <span class="cf">else</span> {
      <span class="kw">stop</span>(<span class="st">&quot;WHAT?!&quot;</span>)
      <span class="kw">cat</span>(<span class="st">&quot;Constructing the augmented dice enterprises for +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
      <span class="cf">if</span>(i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
        de_list[[i<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>de<span class="op">$</span><span class="kw">increase.degree</span>(<span class="dv">1</span>)
      } <span class="cf">else</span> {
        de_list[[i<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>de_list[[i<span class="op">-</span><span class="dv">1</span>]]<span class="op">$</span><span class="kw">increase.degree</span>(<span class="dv">1</span>)
      }
      <span class="co">#Save object</span>
      <span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="dt">de_aug=</span>de_list[[i<span class="op">+</span><span class="dv">1</span>]],<span class="dt">i=</span>i), <span class="dt">file =</span> <span class="kw">paste0</span>(<span class="st">&quot;efficiency_uni_data/ladder_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
    }
  
}

<span class="co">#For each ladder get empirical number of tosses and bound</span>
<span class="kw">cat</span>(<span class="st">&quot;Computing empirical number of tosses and bound </span><span class="ch">\n</span><span class="st">&quot;</span>)
emp_tosses &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> n, <span class="dt">ncol =</span> increase_degree<span class="op">+</span><span class="dv">1</span>)
emp_res &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> n, <span class="dt">ncol =</span> increase_degree<span class="op">+</span><span class="dv">1</span>)
<span class="kw">colnames</span>(emp_tosses) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;+&quot;</span>,<span class="dv">0</span><span class="op">:</span>increase_degree)
<span class="kw">colnames</span>(emp_res) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;+&quot;</span>,<span class="dv">0</span><span class="op">:</span>increase_degree)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>increase_degree) {
  <span class="co">#Check if it already exists</span>
  <span class="cf">if</span>(<span class="kw">file.exists</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_uni_data/n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))) {
    <span class="kw">cat</span>(<span class="st">&quot;Restoring previous work for degree +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
    prev_work &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_uni_data/n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
    emp_tosses[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>prev_work<span class="op">$</span>emp_tosses
    emp_res[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>prev_work<span class="op">$</span>emp_res
  } <span class="cf">else</span> {
    <span class="kw">cat</span>(<span class="st">&quot;Getting empirical tosses for +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
    aux &lt;-<span class="st"> </span>de_list[[i<span class="op">+</span><span class="dv">1</span>]]<span class="op">$</span><span class="kw">sample</span>(<span class="dt">n=</span>n, <span class="dt">true_p =</span> <span class="kw">c</span>(p,<span class="dv">1</span><span class="op">-</span>p), <span class="dt">num_cores =</span> num_cores, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
    emp_tosses[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>aux[[<span class="dv">2</span>]]
    emp_res[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>aux[[<span class="dv">1</span>]]
    <span class="co">#Save object</span>
    <span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="dt">emp_tosses=</span>aux[[<span class="dv">2</span>]],<span class="dt">emp_res=</span>aux[[<span class="dv">1</span>]]), <span class="dt">file =</span> <span class="kw">paste0</span>(<span class="st">&quot;efficiency_uni_data/n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Prepare output</span>
res_output &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> increase_degree<span class="op">+</span><span class="dv">1</span>)
<span class="kw">colnames</span>(res_output) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;+&quot;</span>,<span class="dv">0</span><span class="op">:</span>increase_degree)
<span class="kw">rownames</span>(res_output) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Exp.Tosses&quot;</span>,<span class="st">&quot;Efficiency.Condition&quot;</span>)
res_output[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">apply</span>(emp_tosses,<span class="dv">2</span>,mean)
res_output[<span class="dv">2</span>,] &lt;-<span class="st"> </span><span class="kw">sapply</span>(de_list, <span class="cf">function</span>(x) {x<span class="op">$</span><span class="kw">get.efficiency.condition</span>()})
<span class="kw">print</span>(res_output)
<span class="co">#&gt;                            +0       +1       +2       +3       +4       +5</span>
<span class="co">#&gt; Exp.Tosses           5337.692 4148.423 4147.423 2007.262 2006.262 1640.265</span>
<span class="co">#&gt; Efficiency.Condition    0.000    0.000    0.000    0.000    0.000    0.000</span>
<span class="co">#&gt;                            +6       +7       +8       +9      +10     +11</span>
<span class="co">#&gt; Exp.Tosses           1639.265 1148.496 1147.496 1012.188 1011.801 824.197</span>
<span class="co">#&gt; Efficiency.Condition    0.000    0.000    0.000    0.000    0.000   0.000</span>
<span class="co">#&gt;                          +12     +13     +14     +15     +16     +17</span>
<span class="co">#&gt; Exp.Tosses           824.299 754.608 755.346 685.968 686.124 625.245</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +18    +19     +20    +21     +22     +23     +24</span>
<span class="co">#&gt; Exp.Tosses           625.238 586.26 585.727 568.36 567.813 533.453 534.064</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.00   0.000   0.00   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +25     +26     +27    +28     +29     +30</span>
<span class="co">#&gt; Exp.Tosses           534.191 534.666 507.033 507.17 495.296 496.038</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.00   0.000   0.000</span>
<span class="co">#&gt;                          +31     +32     +33     +34     +35    +36</span>
<span class="co">#&gt; Exp.Tosses           494.522 493.639 483.351 482.952 474.646 475.17</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.00</span>
<span class="co">#&gt;                          +37    +38     +39     +40     +41     +42</span>
<span class="co">#&gt; Exp.Tosses           463.621 463.26 471.249 471.443 468.031 467.855</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.00   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +43     +44     +45     +46     +47     +48</span>
<span class="co">#&gt; Exp.Tosses           465.589 465.884 468.637 468.286 461.053 460.549</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +49     +50     +51     +52     +53     +54</span>
<span class="co">#&gt; Exp.Tosses           470.946 470.369 471.037 470.843 476.023 475.637</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +55     +56    +57     +58     +59     +60     +61</span>
<span class="co">#&gt; Exp.Tosses           470.89 470.857 481.66 481.312 481.062 481.675 486.467</span>
<span class="co">#&gt; Efficiency.Condition   0.00   0.000   0.00   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +62     +63     +64     +65     +66     +67</span>
<span class="co">#&gt; Exp.Tosses           487.133 494.313 493.956 494.726 495.153 497.648</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +68     +69     +70     +71     +72     +73   +74</span>
<span class="co">#&gt; Exp.Tosses           497.783 503.526 503.711 509.307 511.513 515.735 515.7</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000   0.0</span>
<span class="co">#&gt;                          +75    +76     +77     +78     +79     +80</span>
<span class="co">#&gt; Exp.Tosses           515.418 515.89 521.839 521.839 530.252 529.292</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.00   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +81     +82     +83    +84     +85     +86</span>
<span class="co">#&gt; Exp.Tosses           533.288 533.137 543.345 543.07 545.755 545.608</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.00   0.000   0.000</span>
<span class="co">#&gt;                          +87     +88     +89     +90     +91     +92</span>
<span class="co">#&gt; Exp.Tosses           554.955 553.925 554.869 555.973 558.457 558.469</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +93     +94     +95     +96     +97     +98</span>
<span class="co">#&gt; Exp.Tosses           561.129 561.008 577.132 578.123 580.142 580.431</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                          +99    +100    +101    +102    +103   +104</span>
<span class="co">#&gt; Exp.Tosses           590.589 590.416 596.387 595.716 598.635 599.22</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.00</span>
<span class="co">#&gt;                         +105    +106    +107    +108    +109    +110</span>
<span class="co">#&gt; Exp.Tosses           609.082 608.773 613.324 614.164 625.386 625.901</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +111    +112    +113    +114    +115    +116</span>
<span class="co">#&gt; Exp.Tosses           630.439 629.712 632.519 631.527 643.567 644.395</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +117    +118    +119  +120    +121    +122    +123</span>
<span class="co">#&gt; Exp.Tosses           652.006 653.539 646.184 647.9 656.435 656.937 651.741</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.0   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +124    +125    +126    +127    +128    +129</span>
<span class="co">#&gt; Exp.Tosses           651.725 663.815 664.065 675.053 673.954 677.708</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +130    +131    +132    +133    +134    +135</span>
<span class="co">#&gt; Exp.Tosses           678.863 690.864 690.067 682.569 682.911 704.993</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +136    +137    +138    +139    +140    +141  +142</span>
<span class="co">#&gt; Exp.Tosses           705.476 696.688 697.076 716.952 717.219 703.406 703.9</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000   0.0</span>
<span class="co">#&gt;                         +143    +144    +145    +146    +147   +148</span>
<span class="co">#&gt; Exp.Tosses           716.429 716.088 719.611 718.557 724.665 724.92</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.00</span>
<span class="co">#&gt;                         +149    +150   +151    +152  +153    +154    +155</span>
<span class="co">#&gt; Exp.Tosses           728.091 729.116 742.35 741.049 741.3 741.406 752.438</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.00   0.000   0.0   0.000   0.000</span>
<span class="co">#&gt;                         +156    +157    +158    +159    +160    +161</span>
<span class="co">#&gt; Exp.Tosses           753.202 759.021 758.402 772.235 774.168 768.989</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +162    +163    +164    +165   +166    +167</span>
<span class="co">#&gt; Exp.Tosses           768.735 781.919 780.888 792.539 791.77 787.472</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.00   0.000</span>
<span class="co">#&gt;                         +168    +169    +170    +171    +172    +173</span>
<span class="co">#&gt; Exp.Tosses           788.205 806.298 806.708 802.954 803.455 809.178</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +174    +175    +176    +177    +178    +179</span>
<span class="co">#&gt; Exp.Tosses           807.775 822.018 822.547 823.061 823.107 839.486</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +180  +181    +182    +183    +184    +185    +186</span>
<span class="co">#&gt; Exp.Tosses           840.171 837.7 837.989 852.061 851.606 849.281 848.954</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.0   0.000   0.000   0.000   0.000   0.000</span>
<span class="co">#&gt;                         +187    +188    +189    +190   +191    +192</span>
<span class="co">#&gt; Exp.Tosses           860.454 858.454 855.702 857.129 866.12 865.308</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.00   0.000</span>
<span class="co">#&gt;                         +193    +194    +195    +196   +197    +198</span>
<span class="co">#&gt; Exp.Tosses           872.395 871.965 880.432 880.683 878.97 878.818</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.000   0.00   0.000</span>
<span class="co">#&gt;                         +199    +200    +201   +202    +203    +204</span>
<span class="co">#&gt; Exp.Tosses           892.075 892.301 890.961 891.38 903.282 902.458</span>
<span class="co">#&gt; Efficiency.Condition   0.000   0.000   0.000   0.00   1.000   1.000</span>
<span class="co">#&gt;                         +205    +206    +207    +208    +209   +210</span>
<span class="co">#&gt; Exp.Tosses           901.405 902.018 910.531 910.157 908.184 907.85</span>
<span class="co">#&gt; Efficiency.Condition   1.000   1.000   1.000   1.000   1.000   1.00</span>
<span class="co">#&gt;                         +211    +212    +213    +214    +215    +216</span>
<span class="co">#&gt; Exp.Tosses           914.236 914.979 918.511 919.025 922.237 922.701</span>
<span class="co">#&gt; Efficiency.Condition   1.000   1.000   1.000   1.000   1.000   1.000</span>
<span class="co">#&gt;                         +217    +218   +219    +220    +221    +222</span>
<span class="co">#&gt; Exp.Tosses           920.593 921.041 926.51 927.324 939.123 939.134</span>
<span class="co">#&gt; Efficiency.Condition   1.000   1.000   1.00   1.000   1.000   1.000</span>
<span class="co">#&gt;                         +223    +224    +225    +226    +227    +228</span>
<span class="co">#&gt; Exp.Tosses           940.786 940.837 958.618 958.501 958.047 959.218</span>
<span class="co">#&gt; Efficiency.Condition   1.000   1.000   1.000   1.000   1.000   1.000</span>
<span class="co">#&gt;                         +229    +230    +231    +232    +233    +234</span>
<span class="co">#&gt; Exp.Tosses           960.134 960.613 965.278 967.115 970.545 969.325</span>
<span class="co">#&gt; Efficiency.Condition   1.000   1.000   1.000   1.000   1.000   1.000</span>
<span class="co">#&gt;                         +235   +236    +237    +238    +239    +240   +241</span>
<span class="co">#&gt; Exp.Tosses           971.794 971.34 976.338 974.908 995.998 996.387 996.05</span>
<span class="co">#&gt; Efficiency.Condition   1.000   1.00   1.000   1.000   1.000   1.000   1.00</span>
<span class="co">#&gt;                         +242    +243    +244     +245     +246     +247</span>
<span class="co">#&gt; Exp.Tosses           995.779 1005.05 1003.87 1002.813 1003.533 1014.566</span>
<span class="co">#&gt; Efficiency.Condition   1.000    1.00    1.00    1.000    1.000    1.000</span>
<span class="co">#&gt;                          +248     +249     +250     +251     +252     +253</span>
<span class="co">#&gt; Exp.Tosses           1015.261 1017.109 1017.294 1021.604 1021.668 1022.365</span>
<span class="co">#&gt; Efficiency.Condition    1.000    1.000    1.000    1.000    1.000    1.000</span>
<span class="co">#&gt;                          +254     +255     +256     +257     +258     +259</span>
<span class="co">#&gt; Exp.Tosses           1022.255 1028.505 1027.751 1029.737 1029.341 1039.391</span>
<span class="co">#&gt; Efficiency.Condition    1.000    1.000    1.000    1.000    1.000    1.000</span>
<span class="co">#&gt;                          +260</span>
<span class="co">#&gt; Exp.Tosses           1038.861</span>
<span class="co">#&gt; Efficiency.Condition    1.000</span></code></pre></div>
</div>
<div id="example-5---augmenting-ladder-dice-enterprise" class="section level2">
<h2>Example 5 - Augmenting ladder (Dice enterprise)</h2>
<p>We consider a ladder of the following form, where the true (unknown) <span class="math inline">\(\boldsymbol{p}=(p_1,p_2,p_3)\)</span> is <span class="math inline">\((1/3,1/3,1/3)\)</span>: <span class="math display">\[
\pi(\boldsymbol{p}) \propto \{p_1^ap_2^ap_3^a,p_1^{3a},p_2^{3a},p_3^{3a}\}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())
<span class="kw">require</span>(<span class="st">&quot;DiceEnterprise&quot;</span>)
<span class="kw">setwd</span>(<span class="st">&quot;~/Dropbox/OxWaSP/Dice Enterprise/R/DiceEnterprise/vignettes&quot;</span>) <span class="co">#Change accordingly</span>

true_p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="co">#True value of p</span>
a &lt;-<span class="st"> </span><span class="dv">5</span> <span class="co">#Exponent</span>
n &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co">#Size sample CFTP</span>
num_cores &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#Number of cores used</span>
initial_seed &lt;-<span class="st"> </span><span class="dv">7117</span> <span class="co">#Seed for RNG</span>
increase_degree &lt;-<span class="st"> </span><span class="dv">78</span> <span class="co">#How much the degree is increased</span>
de_list &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> increase_degree<span class="op">+</span><span class="dv">1</span>) <span class="co">#Store all the de objects</span>

<span class="kw">set.seed</span>(initial_seed, <span class="st">&quot;L'Ecuyer-CMRG&quot;</span>) 
<span class="co">#Construct the ladder</span>
<span class="kw">cat</span>(<span class="st">&quot;Constructing the dice enterprise </span><span class="ch">\n</span><span class="st">&quot;</span>)
  de &lt;-<span class="st"> </span>DiceEnterprise<span class="op">$</span><span class="kw">new</span>(<span class="dt">G=</span><span class="kw">list</span>(
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">3</span><span class="op">*</span>a,<span class="dv">0</span>,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">3</span>)),
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(a,a,a),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">3</span>)),
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span><span class="op">*</span>a),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">3</span>)),
    <span class="kw">list</span>(<span class="dv">1</span>,<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span><span class="op">*</span>a,<span class="dv">0</span>),<span class="dt">nrow=</span><span class="dv">1</span>,<span class="dt">ncol=</span><span class="dv">3</span>))
  ))
  de_list[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>de
  <span class="kw">cat</span>(<span class="st">&quot;Constructing the augmented dice enterprises </span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>increase_degree) {
    <span class="co">#Check if it already exists</span>
    <span class="cf">if</span>(<span class="kw">file.exists</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_multi_data/ladder_n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))) {
      <span class="kw">cat</span>(<span class="st">&quot;Restoring previous work for degree +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
      prev_work &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_multi_data/ladder_n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
      de_list[[i<span class="op">+</span><span class="dv">1</span>]]  &lt;-<span class="st"> </span>prev_work<span class="op">$</span>de_aug
    } <span class="cf">else</span> {
      <span class="kw">cat</span>(<span class="st">&quot;Constructing the augmented dice enterprises for +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
      <span class="cf">if</span>(i <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
        de_list[[i<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>de<span class="op">$</span><span class="kw">increase.degree</span>(<span class="dv">1</span>)
      } <span class="cf">else</span> {
        de_list[[i<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span>de_list[[i<span class="op">-</span><span class="dv">1</span>]]<span class="op">$</span><span class="kw">increase.degree</span>(<span class="dv">1</span>)
      }
      <span class="co">#Save object</span>
      <span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="dt">de_aug=</span>de_list[[i<span class="op">+</span><span class="dv">1</span>]],<span class="dt">i=</span>i), <span class="dt">file =</span> <span class="kw">paste0</span>(<span class="st">&quot;efficiency_multi_data/ladder_n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
    }
  }
  

<span class="co">#For each ladder get empirical number of tosses</span>
<span class="kw">cat</span>(<span class="st">&quot;Computing empirical number of tosses </span><span class="ch">\n</span><span class="st">&quot;</span>)
emp_tosses &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> n, <span class="dt">ncol =</span> increase_degree<span class="op">+</span><span class="dv">1</span>)
emp_res &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> n, <span class="dt">ncol =</span> increase_degree<span class="op">+</span><span class="dv">1</span>)
<span class="kw">colnames</span>(emp_tosses) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;+&quot;</span>,<span class="dv">0</span><span class="op">:</span>increase_degree)
<span class="kw">colnames</span>(emp_res) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;+&quot;</span>,<span class="dv">0</span><span class="op">:</span>increase_degree)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>increase_degree) {
  <span class="co">#Check if it already exists</span>
  <span class="cf">if</span>(<span class="kw">file.exists</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_multi_data/n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))) {
    <span class="kw">cat</span>(<span class="st">&quot;Restoring previous work for degree +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
    prev_work &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">paste0</span>(<span class="st">&quot;efficiency_multi_data/n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
    emp_tosses[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>prev_work<span class="op">$</span>emp_tosses
    emp_res[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>prev_work<span class="op">$</span>emp_res
  } <span class="cf">else</span> {
    <span class="kw">cat</span>(<span class="st">&quot;Getting empirical tosses for +&quot;</span>,i,<span class="st">&quot; </span><span class="ch">\n</span><span class="st">&quot;</span>)
    aux &lt;-<span class="st"> </span>de_list[[i<span class="op">+</span><span class="dv">1</span>]]<span class="op">$</span><span class="kw">sample</span>(<span class="dt">n=</span>n, <span class="dt">true_p =</span> true_p, <span class="dt">num_cores =</span> num_cores, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
    emp_tosses[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>aux[[<span class="dv">2</span>]]
    emp_res[,i<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>aux[[<span class="dv">1</span>]]
    <span class="co">#Save object</span>
    <span class="kw">saveRDS</span>(<span class="kw">list</span>(<span class="dt">emp_tosses=</span>aux[[<span class="dv">2</span>]],<span class="dt">emp_res=</span>aux[[<span class="dv">1</span>]]), <span class="dt">file =</span> <span class="kw">paste0</span>(<span class="st">&quot;efficiency_multi_data/n_&quot;</span>,n,<span class="st">&quot;_a_&quot;</span>,a,<span class="st">&quot;_degree_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>))
  }
}

<span class="kw">apply</span>(emp_tosses,<span class="dv">2</span>,mean)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Prepare output</span>
res_output &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> increase_degree<span class="op">+</span><span class="dv">1</span>)
<span class="kw">colnames</span>(res_output) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;+&quot;</span>,<span class="dv">0</span><span class="op">:</span>increase_degree)
res_output[<span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">apply</span>(emp_tosses,<span class="dv">2</span>,mean)
<span class="kw">print</span>(res_output)
<span class="co">#&gt;            +0       +1       +2      +3      +4       +5       +6       +7</span>
<span class="co">#&gt; [1,] 174246.4 28518.22 28514.22 8811.63 8807.63 4359.461 4355.461 3033.089</span>
<span class="co">#&gt;            +8       +9      +10      +11      +12      +13      +14</span>
<span class="co">#&gt; [1,] 3043.496 2566.722 2569.023 2090.126 2089.208 1814.473 1811.589</span>
<span class="co">#&gt;           +15      +16    +17      +18      +19      +20      +21      +22</span>
<span class="co">#&gt; [1,] 1573.085 1580.566 1454.5 1452.779 1341.925 1341.517 1266.911 1267.524</span>
<span class="co">#&gt;           +23      +24      +25      +26      +27      +28      +29</span>
<span class="co">#&gt; [1,] 1169.254 1166.061 1093.352 1092.945 1060.294 1061.896 1033.363</span>
<span class="co">#&gt;           +30      +31      +32     +33     +34     +35     +36     +37</span>
<span class="co">#&gt; [1,] 1032.945 1006.591 1006.796 971.897 971.344 981.588 978.774 938.971</span>
<span class="co">#&gt;          +38     +39     +40     +41     +42     +43     +44     +45</span>
<span class="co">#&gt; [1,] 941.034 915.581 912.539 902.949 901.488 866.863 865.192 882.106</span>
<span class="co">#&gt;          +46   +47     +48     +49     +50   +51     +52     +53     +54</span>
<span class="co">#&gt; [1,] 879.884 876.8 876.285 876.051 874.039 876.2 877.426 881.812 881.373</span>
<span class="co">#&gt;          +55     +56     +57     +58     +59     +60     +61     +62</span>
<span class="co">#&gt; [1,] 875.644 874.078 862.354 863.762 838.675 841.442 840.226 841.383</span>
<span class="co">#&gt;          +63     +64     +65     +66     +67    +68     +69     +70</span>
<span class="co">#&gt; [1,] 816.543 816.122 852.993 853.096 843.629 843.74 860.019 860.096</span>
<span class="co">#&gt;          +71     +72     +73     +74     +75     +76     +77     +78</span>
<span class="co">#&gt; [1,] 845.238 843.975 850.235 848.677 842.597 843.023 858.113 857.019</span></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
